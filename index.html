<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gains Network</title></head>
  <style>
    body {
      color: white;
      background-color: black;
    }
  </style>
<body>
  <div id="msg"></div>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script type="module">
  import { ethers, Contract, formatEther } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";
  const rewardsAbi = [{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"version","type":"uint8"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"name","type":"string"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"NumberUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"bot","type":"address"},{"indexed":false,"internalType":"uint256","name":"fromRound","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"toRound","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"tokens","type":"uint256"}],"name":"PoolTokensClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"bot","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokens","type":"uint256"}],"name":"TokensClaimed","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"indexed":false,"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"id","type":"tuple"},{"indexed":false,"internalType":"address","name":"first","type":"address"},{"indexed":false,"internalType":"uint256","name":"sameBlockCount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"sameBlockLimit","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"reward","type":"uint256"}],"name":"TriggerRewarded","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"indexed":false,"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"id","type":"tuple"}],"name":"TriggerUnregistered","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"indexed":false,"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"id","type":"tuple"},{"indexed":false,"internalType":"address","name":"bot","type":"address"},{"indexed":false,"internalType":"uint256","name":"linkFee","type":"uint256"}],"name":"TriggeredFirst","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"indexed":false,"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"id","type":"tuple"},{"indexed":false,"internalType":"address","name":"bot","type":"address"},{"indexed":false,"internalType":"uint256","name":"linkContribution","type":"uint256"}],"name":"TriggeredSameBlock","type":"event"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"botInUse","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_fromRound","type":"uint256"},{"internalType":"uint256","name":"_toRound","type":"uint256"}],"name":"claimPoolTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"claimTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"start","type":"uint256"},{"internalType":"uint256","name":"end","type":"uint256"}],"name":"copyOldLimitTypes","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"currentOrder","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"currentRound","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"},{"internalType":"uint256","name":"_reward","type":"uint256"},{"internalType":"uint256","name":"_tokenPriceDai","type":"uint256"}],"name":"distributeNftReward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"triggerBlock","type":"uint256"},{"internalType":"address","name":"bot","type":"address"},{"internalType":"uint256","name":"nftId","type":"uint256"},{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getNftBotHashes","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"contract StorageInterfaceV5","name":"_storageT","type":"address"},{"internalType":"uint256","name":"_triggerTimeout","type":"uint256"},{"internalType":"uint256","name":"_sameBlockLimit","type":"uint256"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"linkFee","type":"uint256"},{"internalType":"uint256","name":"tokenPrice","type":"uint256"}],"name":"linkToTokenRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"nftHash","type":"bytes32"},{"internalType":"bytes32","name":"botHash","type":"bytes32"}],"name":"nftBotInUse","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"openLimitOrderTypes","outputs":[{"internalType":"enum GNSNftRewardsV6_3_1.OpenLimitOrderType","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"roundOrdersToClaim","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"roundTokens","outputs":[{"internalType":"uint240","name":"tokens","type":"uint240"},{"internalType":"uint16","name":"totalEntries","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"sameBlockLimit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"}],"name":"sameBlockTriggers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"nftHash","type":"bytes32"},{"internalType":"bytes32","name":"botHash","type":"bytes32"}],"name":"setNftBotInUse","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_trader","type":"address"},{"internalType":"uint256","name":"_pairIndex","type":"uint256"},{"internalType":"uint256","name":"_index","type":"uint256"},{"internalType":"enum GNSNftRewardsV6_3_1.OpenLimitOrderType","name":"_type","type":"uint8"}],"name":"setOpenLimitOrderType","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"setStateCopyAsDone","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"stateCopied","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"storageT","outputs":[{"internalType":"contract StorageInterfaceV5","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"},{"internalType":"address","name":"_bot","type":"address"},{"internalType":"uint256","name":"_linkFee","type":"uint256"}],"name":"storeFirstToTrigger","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"},{"internalType":"address","name":"_bot","type":"address"}],"name":"storeTriggerSameBlock","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"}],"name":"timedOut","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"tokensClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"tokensClaimedTotal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"tokensToClaim","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"triggerTimeout","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"}],"name":"triggered","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"","type":"uint8"}],"name":"triggeredLimits","outputs":[{"internalType":"address","name":"first","type":"address"},{"internalType":"uint256","name":"block","type":"uint256"},{"internalType":"uint240","name":"linkFee","type":"uint240"},{"internalType":"uint16","name":"sameBlockLimit","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"trader","type":"address"},{"internalType":"uint256","name":"pairIndex","type":"uint256"},{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"enum StorageInterfaceV5.LimitOrder","name":"order","type":"uint8"}],"internalType":"struct GNSNftRewardsV6_3_1.TriggeredLimitId","name":"_id","type":"tuple"}],"name":"unregisterTrigger","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_sameBlockLimit","type":"uint256"}],"name":"updateSameBlockLimit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_triggerTimeout","type":"uint256"}],"name":"updateTriggerTimeout","outputs":[],"stateMutability":"nonpayable","type":"function"}]
  const rewardsAddr = '0xde5750071CacA8db173FC6543D23d0BCACACFEC3'
  const wAddr = '0x6A33B68894C643a92B94A95B6D950adD64B2a179'
  let provider = new ethers.JsonRpcProvider('https://arb1.arbitrum.io/rpc')
  let rewardsContract = new Contract(rewardsAddr, rewardsAbi, provider)
  let msg = ""
  let pendTotal = 0
  const msgAdd = (label, val) =>{
    msg+= `${label}: ${val}<br>`
  }
  const getRnd = async (rnd) => {
    msgAdd('Round', rnd)
    let tknCurr = await rewardsContract.roundTokens(rnd)
    let tknCurrEth = parseFloat(formatEther(tknCurr.tokens)).toFixed(2)
    msgAdd('Tokens', tknCurrEth)
    let entrCurr = parseInt(tknCurr.totalEntries)
    msgAdd('Entries', entrCurr)
    let claimCurr = await rewardsContract.roundOrdersToClaim(wAddr, rnd)
    msgAdd('Claim', claimCurr)
    let pendTkn = ((tknCurrEth/entrCurr) * parseInt(claimCurr)).toFixed(1)
    msgAdd('Pending', pendTkn)
    pendTotal += pendTkn
  }
  const main = async () => { 
    $('#msg').html('Loading...') 
  try{
    let rnd = await rewardsContract.currentRound()
    for(let r = parseInt(rnd); r > rnd-3; r--){
      getRnd(r)
    }
    msgAdd('Total', pendTotal)
    $('#msg').html(msg)
  } catch (e){
    alert(e)
  }
  }
  main()
  </script>
</body>
</html>
